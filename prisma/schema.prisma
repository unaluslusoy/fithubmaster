generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// -----------------------------------------------------------------------------
// ENUMS & SHARED TYPES
// -----------------------------------------------------------------------------

enum AdminRole {
  SUPER_ADMIN
  EDITOR
  SUPPORT
}

enum AccountStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
  PENDING
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

// -----------------------------------------------------------------------------
// 1. SUPER ADMIN PANEL ENTITIES
// -----------------------------------------------------------------------------

model Admin {
  id              String        @id @default(uuid())
  email           String        @unique
  passwordHash    String        @map("password_hash")
  firstName       String        @map("first_name")
  lastName        String        @map("last_name")
  avatarUrl       String?       @map("avatar_url")
  role            AdminRole     @default(SUPER_ADMIN)
  status          AccountStatus @default(ACTIVE)
  
  // Relations for Permission Management
  userGroupId     String?       @map("user_group_id")
  userGroup       UserGroup?    @relation(fields: [userGroupId], references: [id])

  lastLoginAt     DateTime?     @map("last_login_at")
  createdAt       DateTime      @default(now()) @map("created_at")
  updatedAt       DateTime      @updatedAt @map("updated_at")

  @@map("admins")
}

model UserGroup {
  id          String       @id @default(uuid())
  name        String       @unique
  description String?
  permissions Permission[]
  admins      Admin[]      // Admins belonging to this group
  
  createdAt   DateTime     @default(now()) @map("created_at")
  updatedAt   DateTime     @updatedAt @map("updated_at")

  @@map("user_groups")
}

model Permission {
  id          String      @id @default(uuid())
  action      String      // e.g. "create", "read", "update"
  subject     String      // e.g. "trainers", "finance", "settings"
  description String?
  
  groups      UserGroup[]
  
  createdAt   DateTime    @default(now()) @map("created_at")
  updatedAt   DateTime    @updatedAt @map("updated_at")
  
  @@unique([action, subject])
  @@map("permissions")
}

// -----------------------------------------------------------------------------
// 2. TRAINER PANEL ENTITIES
// -----------------------------------------------------------------------------

model Trainer {
  id              String        @id @default(uuid())
  email           String        @unique
  passwordHash    String        @map("password_hash")
  firstName       String        @map("first_name")
  lastName        String        @map("last_name")
  phone           String?
  avatarUrl       String?       @map("avatar_url")
  status          AccountStatus @default(PENDING)
  
  // Professional Details
  bio             String?
  specializations String[]
  certifications  String[]
  experienceYears Int           @default(0) @map("experience_years")
  hourlyRate      Decimal?      @map("hourly_rate")
  rating          Decimal?      @default(0)
  totalStudents   Int           @default(0) @map("total_students")
  isVerified      Boolean       @default(false) @map("is_verified")
  
  // Relations
  clients         Client[]
  workoutPlans    WorkoutPlan[]
  nutritionPlans  NutritionPlan[]
  appointments    Appointment[]
  
  lastLoginAt     DateTime?     @map("last_login_at")
  createdAt       DateTime      @default(now()) @map("created_at")
  updatedAt       DateTime      @updatedAt @map("updated_at")

  @@map("trainers")
}

// -----------------------------------------------------------------------------
// 3. CLIENT (STUDENT) PANEL ENTITIES
// -----------------------------------------------------------------------------

model Client {
  id              String        @id @default(uuid())
  email           String        @unique
  passwordHash    String        @map("password_hash")
  firstName       String        @map("first_name")
  lastName        String        @map("last_name")
  phone           String?
  avatarUrl       String?       @map("avatar_url")
  status          AccountStatus @default(ACTIVE)
  
  // Physical Profile
  height          Float?        // cm
  weight          Float?        // kg
  birthDate       DateTime?     @map("birth_date")
  gender          Gender?
  fitnessLevel    String?       @map("fitness_level")
  goals           String?
  medicalConditions String?     @map("medical_conditions")
  
  // Relations
  trainerId       String?       @map("trainer_id")
  trainer         Trainer?      @relation(fields: [trainerId], references: [id])
  
  activePlanId    String?       @map("active_plan_id")
  nutritionPlans  NutritionPlan[]
  appointments    Appointment[]

  lastLoginAt     DateTime?     @map("last_login_at")
  createdAt       DateTime      @default(now()) @map("created_at")
  updatedAt       DateTime      @updatedAt @map("updated_at")

  @@map("clients")
}

// -----------------------------------------------------------------------------
// 4. SHARED MODULES (Workout, Nutrition, Calendar, Finance)
// -----------------------------------------------------------------------------

model WorkoutPlan {
  id              String   @id @default(uuid())
  trainerId       String   @map("trainer_id")
  trainer         Trainer  @relation(fields: [trainerId], references: [id])
  
  // If assigned to a specific client
  clientId        String?  @map("client_id")
  // Note: We can add Client relation if needed, but usually templates are generic
  
  name            String
  description     String?
  difficulty      String?
  durationWeeks   Int?     @map("duration_weeks")
  isTemplate      Boolean  @default(false) @map("is_template")

  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  @@map("workout_plans")
}

model NutritionPlan {
  id              String   @id @default(uuid())
  trainerId       String   @map("trainer_id")
  trainer         Trainer  @relation(fields: [trainerId], references: [id])
  
  clientId        String?  @map("client_id")
  client          Client?  @relation(fields: [clientId], references: [id])

  name            String
  dailyCalories   Int?     @map("daily_calories")
  proteinGrams    Int?     @map("protein_grams")
  carbsGrams      Int?     @map("carbs_grams")
  fatGrams        Int?     @map("fat_grams")
  
  startDate       DateTime? @map("start_date")
  endDate         DateTime? @map("end_date")

  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  @@map("nutrition_plans")
}

model Appointment {
  id              String   @id @default(uuid())
  trainerId       String   @map("trainer_id")
  trainer         Trainer  @relation(fields: [trainerId], references: [id])
  
  clientId        String   @map("client_id")
  client          Client   @relation(fields: [clientId], references: [id])

  title           String
  startTime       DateTime @map("start_time")
  endTime         DateTime @map("end_time")
  location        String?
  status          String   @default("PENDING") // PENDING, CONFIRMED, CANCELLED
  notes           String?
  reminderSent    Boolean  @default(false) @map("reminder_sent")

  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  @@map("appointments")
}

model Package {
  id              String   @id @default(uuid())
  name            String
  description     String?
  price           Decimal
  currency        String   @default("TRY")
  
  durationDays    Int      @map("duration_days")
  maxStudents     Int?     @map("max_students")
  maxTrainers     Int?     @map("max_trainers")
  features        String[]
  isActive        Boolean  @default(true) @map("is_active")
  
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  @@map("packages")
}
